{% extends "base.html" %}

{% block title %}Get Weekly Game Updates!{% endblock %}

{% block meta %}
<meta
  name="description"
  content="Subscribe to our newsletter to receive the latest game updates from Prime Gaming, Epic Store, and more!"
/>
<meta
  name="keywords"
  content="Newsletter, Gaming Updates, Free Games, Email Subscription, Prime Gaming, Epic Store"
/>
{% endblock meta %}

{% block content %}
<!-- Set the GAMES_JSON_PATH as a global JavaScript variable -->
<script>
    window.GAMES_JSON_PATH = "{{ games_json_path }}"
</script>

<section class="hero-section" id="about">
  <div class="container">
    <div class="row align-items-center min-vh-75">
      <div class="col-lg-6 hero-content">
        <h1 class="display-4 fw-bold mb-4">Never miss a free game again</h1>
        <p class="lead mb-4">
          Join other gamers getting the latest free games from Prime Gaming, Epic Store, and more - delivered straight to their inbox.
        </p>
        <a href="#subscribe" class="btn btn-primary btn-lg mb-4">Get Started</a>
      </div>
      <div class="col-lg-6 hero-image">
        <div id="game-slideshow" class="shadow-lg rounded-lg overflow-hidden"></div>
      </div>
    </div>
  </div>
</section>

<!-- Features Section -->
<section class="features-section py-5">
  <div class="container">
    <div class="row g-4">
      <div class="col-md-4">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-clock"></i>
          </div>
          <h3>Weekly Updates</h3>
          <p>Stay informed about new free games every week, right when they become available.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-envelope"></i>
          </div>
          <h3>One Newsletter</h3>
          <p>All free games from different platforms consolidated in a single, easy-to-read email.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-gamepad"></i>
          </div>
          <h3>Current Games</h3>
          <p>Check out <a href="/AvailableGames" class="feature-link">currently available games</a> anytime!</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Subscribe Section -->
<section class="subscribe-section py-5" id="subscribe">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-6">
        <div class="subscribe-card">
          <div class="card-body">
            <h2 class="text-center mb-4">Join WeeklyGameVault</h2>
            <p class="text-center mb-4">
              Get notified about free games and never miss an opportunity to expand your library!
            </p>

            <form id="newsletterForm" class="subscription-form">
              <div class="form-floating mb-4">
                <input
                  type="email"
                  class="form-control"
                  id="emailInput"
                  name="email"
                  placeholder="name@example.com"
                  required
                />
                <label for="emailInput">Email address</label>
              </div>

              <div class="frequency-options mb-4">
                <p class="form-label">Newsletter Frequency:</p>
                <div class="frequency-grid">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="frequency"
                      id="weeklyOption"
                      value="weekly"
                      required
                    >
                    <label class="form-check-label" for="weeklyOption">
                      <i class="fas fa-calendar-week"></i>
                      Weekly Digest
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="frequency"
                      id="newGameOption"
                      value="newgame"
                      required
                    >
                    <label class="form-check-label" for="newGameOption">
                      <i class="fas fa-bell"></i>
                      Instant Updates
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="frequency"
                      id="bothOption"
                      value="both"
                      required
                    >
                    <label class="form-check-label" for="bothOption">
                      <i class="fas fa-star"></i>
                      Both Options
                    </label>
                  </div>
                </div>
              </div>

              <div class="form-check mb-4">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="privacyCheck"
                  required
                />
                <label class="form-check-label" for="privacyCheck">
                  By subscribing, I accept the <a href="https://www.weeklygamevault.com/PrivacyPolicy" class="text-primary" target="_blank" rel="noopener noreferrer">Privacy Policy</a>
                </label>
              </div>

              <button type="submit" class="btn btn-primary w-100" id="subscribeBtn">
                <span
                  class="spinner-border spinner-border-sm me-2"
                  role="status"
                  aria-hidden="true"
                  id="loadingSpinner"
                  style="display: none;"
                ></span>
                Subscribe Now
              </button>
              
              <div class="mt-4 text-center">
                <small class="text-muted">
                  <i class="fas fa-shield-alt me-1"></i>
                  Your privacy is protected. Unsubscribe anytime.
                </small>
              </div>
              <div class="message mt-3 text-center" id="statusMessage"></div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Telegram Bot Section -->
<section class="telegram-section py-5 bg-light">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-6">
        <div class="text-center">
          <div class="telegram-icon mb-4">
            <i class="fab fa-telegram fa-4x text-primary"></i>
          </div>
          <h2 class="mb-4">Prefer Telegram?</h2>
          <p class="lead mb-4">
            Not a fan of emails? No worries! Get instant updates about free games directly through our Telegram bot.
          </p>
          <a 
            href="https://t.me/Weeklygamevault_bot" 
            target="_blank" 
            rel="noopener noreferrer" 
            class="btn btn-primary btn-lg"
          >
            <i class="fab fa-telegram me-2"></i>
            Subscribe via Telegram
          </a>
          <div class="mt-4">
            <small class="text-muted">
              <i class="fas fa-bolt me-1"></i>
              Fast updates, zero inbox clutter!
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock content %}

{% block extra_scripts %}
<script>
  // Set the GAMES_JSON_PATH as a global variable
  window.GAMES_JSON_PATH = "{{ games_json_path }}"
</script>

<script>
  // Newsletter Form Submission
  document
    .getElementById("newsletterForm")
    .addEventListener("submit", async function (event) {
      event.preventDefault();

      const emailInput = document.getElementById("emailInput");
      const statusMessage = document.getElementById("statusMessage");
      const subscribeBtn = document.getElementById("subscribeBtn");
      const loadingSpinner = document.getElementById("loadingSpinner");

      loadingSpinner.style.display = "inline-block";
      subscribeBtn.disabled = true;

      const formData = new FormData();
      formData.append("email", emailInput.value);

      const frequencyElems = document.getElementsByName("frequency");
      let selectedFrequency = "";
      for (let i = 0; i < frequencyElems.length; i++) {
        if (frequencyElems[i].checked) {
          selectedFrequency = frequencyElems[i].value;
          break;
        }
      }
      formData.append("frequency", selectedFrequency);

      try {
        const response = await fetch("/subscribe", {
          method: "POST",
          body: formData,
        });

        loadingSpinner.style.display = "none";
        subscribeBtn.disabled = false;

        if (response.ok) {
          const message = await response.text();
          statusMessage.textContent = message;
          statusMessage.style.color = "var(--success-color)";
          emailInput.value = "";
          frequencyElems.forEach(radio => (radio.checked = false));
        } else if (response.status === 429) {
          statusMessage.textContent =
            "You have made too many requests. Please try again later.";
          statusMessage.style.color = "var(--error-color)";
        } else {
          const errorMessage = await response.text();
          statusMessage.textContent = `Error: ${errorMessage}`;
          statusMessage.style.color = "var(--error-color)";
        }
      } catch (error) {
        loadingSpinner.style.display = "none";
        subscribeBtn.disabled = false;

        statusMessage.textContent = "An unexpected error occurred.";
        statusMessage.style.color = "var(--error-color)";
      }
    });
</script>
<!-- Load the slideshow script -->
<script src="{{ url_for('static', filename='js/game-slideshow.js') }}" defer></script>
{% endblock extra_scripts %}
